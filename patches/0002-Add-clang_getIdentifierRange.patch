From f37235d4993c939e503d7736eeb4af59378fb974 Mon Sep 17 00:00:00 2001
From: Matthias Kleine <matthias_kleine@gmx.de>
Date: Tue, 3 Jan 2012 11:15:15 +0100
Subject: [PATCH 2/3] Add clang_getIdentifierRange

---
 include/clang-c/Index.h         |    2 ++
 tools/libclang/CIndex.cpp       |   21 +++++++++++++++++++++
 tools/libclang/libclang.exports |    1 +
 3 files changed, 24 insertions(+), 0 deletions(-)

diff --git a/include/clang-c/Index.h b/include/clang-c/Index.h
index 34e21fb..df48a45 100644
--- a/include/clang-c/Index.h
+++ b/include/clang-c/Index.h
@@ -2963,6 +2963,8 @@ CINDEX_LINKAGE unsigned clang_CallExpr_getNumArgs(CXCursor C);
 CINDEX_LINKAGE CXCursor clang_CallExpr_getArg(CXCursor C,
                                               unsigned arg_number);
 
+CINDEX_LINKAGE CXSourceRange clang_getIdentifierRange(CXCursor C);
+
 /**
  * \brief Given a cursor that represents a template, determine
  * the cursor kind of the specializations would be generated by instantiating
diff --git a/tools/libclang/CIndex.cpp b/tools/libclang/CIndex.cpp
index e6ab0a2..90c74be 100644
--- a/tools/libclang/CIndex.cpp
+++ b/tools/libclang/CIndex.cpp
@@ -5461,6 +5461,27 @@ CXCursor clang_CallExpr_getArg(CXCursor C,
 }
 
 //===----------------------------------------------------------------------===//
+// Declaration introspection.
+//===----------------------------------------------------------------------===//
+
+extern "C" {
+
+CXSourceRange clang_getIdentifierRange(CXCursor C)
+{
+  if (clang_isDeclaration(C.kind)) {
+    Decl *D = getCursorDecl(C);
+    FunctionDecl *FD = dyn_cast<FunctionDecl>(D);
+    if (FD)
+    {
+      DeclarationNameInfo NameInfo = FD->getNameInfo();
+      SourceRange SR = NameInfo.getSourceRange();
+      return cxloc::translateSourceRange(getCursorContext(C), SR);
+    }
+  }
+  return clang_getCursorExtent(C);
+}
+}
+//===----------------------------------------------------------------------===//
 // Attribute introspection.
 //===----------------------------------------------------------------------===//
 
diff --git a/tools/libclang/libclang.exports b/tools/libclang/libclang.exports
index 0917d50..ba7811e 100644
--- a/tools/libclang/libclang.exports
+++ b/tools/libclang/libclang.exports
@@ -194,3 +194,4 @@ clang_toggleCrashRecovery
 clang_tokenize
 clang_visitChildren
 clang_visitChildrenWithBlock
+clang_getIdentifierRange
-- 
1.7.9

